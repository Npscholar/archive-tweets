/**
 * 
 */
package com.lavish.life.conglomerate.twitter.archive.service;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

import java.io.IOException;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.invocation.InvocationOnMock;
import org.mockito.junit.MockitoJUnitRunner;
import org.mockito.stubbing.Answer;
import org.springframework.http.HttpEntity;
import org.springframework.http.HttpMethod;
import org.springframework.http.ResponseEntity;
import org.springframework.http.converter.json.Jackson2ObjectMapperBuilder;
import org.springframework.security.oauth2.client.OAuth2RestTemplate;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.lavish.life.conglomerate.twitter.archive.model.request.TwitterTweetsSearchAPIRequest;
import com.lavish.life.conglomerate.twitter.archive.model.response.RequestParameters;
import com.lavish.life.conglomerate.twitter.archive.model.response.TwitterTweetsSearchAPIResponse;

/**
 * @author Norbert Powell 
 * @since Created Apr 5, 2019
 *
 */
@RunWith(MockitoJUnitRunner.class)
public class TwitterPremiumSearchServiceTest {
	
	private static final String singlePageResponse = "{\"results\":[{\"created_at\":\"Sat Jul 24 04:10:42 +0000 2010\",\"id\":19394373433,\"id_str\":\"19394373433\",\"text\":\"dont worry @MatchhMyMental i'm deleting it tonight!\",\"source\":\"\\u003ca href=\\\"http:\\/\\/twitter.com\\\" rel=\\\"nofollow\\\"\\u003eTwitter Web Client\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 24 04:05:40 +0000 2010\",\"id\":19394056284,\"id_str\":\"19394056284\",\"text\":\"i swear twitter is gay\",\"source\":\"\\u003ca href=\\\"http:\\/\\/twitter.com\\\" rel=\\\"nofollow\\\"\\u003eTwitter Web Client\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]}],\"requestParameters\":{\"maxResults\":10,\"fromDate\":\"201001010000\",\"toDate\":\"201007310000\"}}";
	private static final String multiPageResponse = "{\"results\":[{\"created_at\":\"Sat Jul 30 19:15:00 +0000 2011\",\"id\":97384715643912192,\"id_str\":\"97384715643912192\",\"text\":\"Bout to ball on concrete again\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 30 19:14:09 +0000 2011\",\"id\":97384502581657600,\"id_str\":\"97384502581657600\",\"text\":\"@__NYStateOfMind hendrix between by new lots\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":97381441259843584,\"in_reply_to_status_id_str\":\"97381441259843584\",\"in_reply_to_user_id\":50446721,\"in_reply_to_user_id_str\":\"50446721\",\"in_reply_to_screen_name\":\"__NYStateOfMind\",\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[{\"screen_name\":\"__NYStateOfMind\",\"name\":\"Paulie Gambino\",\"id\":50446721,\"id_str\":\"50446721\",\"indices\":[0,16]}],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 30 19:13:19 +0000 2011\",\"id\":97384291285213184,\"id_str\":\"97384291285213184\",\"text\":\"@__NYStateOfMind east ny\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":97381441259843584,\"in_reply_to_status_id_str\":\"97381441259843584\",\"in_reply_to_user_id\":50446721,\"in_reply_to_user_id_str\":\"50446721\",\"in_reply_to_screen_name\":\"__NYStateOfMind\",\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[{\"screen_name\":\"__NYStateOfMind\",\"name\":\"Paulie Gambino\",\"id\":50446721,\"id_str\":\"50446721\",\"indices\":[0,16]}],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 30 18:43:04 +0000 2011\",\"id\":97376681194565632,\"id_str\":\"97376681194565632\",\"text\":\"@__NYStateOfMind you should Mack I'm out here at this block party\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":97369126724583424,\"in_reply_to_status_id_str\":\"97369126724583424\",\"in_reply_to_user_id\":50446721,\"in_reply_to_user_id_str\":\"50446721\",\"in_reply_to_screen_name\":\"__NYStateOfMind\",\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":1,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[{\"screen_name\":\"__NYStateOfMind\",\"name\":\"Paulie Gambino\",\"id\":50446721,\"id_str\":\"50446721\",\"indices\":[0,16]}],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 30 18:42:28 +0000 2011\",\"id\":97376528425426945,\"id_str\":\"97376528425426945\",\"text\":\"One half of the block So x2 that by two http:\\/\\/lockerz.com\\/s\\/125089017\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 30 18:12:07 +0000 2011\",\"id\":97368892250398720,\"id_str\":\"97368892250398720\",\"text\":\"#girlsdictionary \\\"I confuse everyone including myself\\\" lol RT @_TayFcknBaby: Ima puzzle, YES indeed! Ever complex in everywayy ...\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[{\"text\":\"girlsdictionary\",\"indices\":[0,16]}],\"urls\":[],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 30 18:10:43 +0000 2011\",\"id\":97368537676521472,\"id_str\":\"97368537676521472\",\"text\":\"There are false rumors going around that bow wow is dead..\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 30 16:54:26 +0000 2011\",\"id\":97349340317753344,\"id_str\":\"97349340317753344\",\"text\":\"Every time I fuck wid this nigga I wanna become a professional Dj\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 30 16:00:13 +0000 2011\",\"id\":97335699866525696,\"id_str\":\"97335699866525696\",\"text\":\"12:00 on the dot\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]},{\"created_at\":\"Sat Jul 30 15:58:47 +0000 2011\",\"id\":97335339005382656,\"id_str\":\"97335339005382656\",\"text\":\"I swear @_TayFcknBaby  and @candidBeautyy argue about everything they remind me of Tay and @__NYStateOfMind\",\"source\":\"\\u003ca href=\\\"http:\\/\\/www.echofon.com\\/\\\" rel=\\\"nofollow\\\"\\u003eEchofon\\u003c\\/a\\u003e\",\"truncated\":false,\"in_reply_to_status_id\":null,\"in_reply_to_status_id_str\":null,\"in_reply_to_user_id\":null,\"in_reply_to_user_id_str\":null,\"in_reply_to_screen_name\":null,\"user\":{\"id\":167825167,\"id_str\":\"167825167\",\"name\":\"Digirlsdem Suga\",\"screen_name\":\"Blessed2Breathe\",\"location\":\"Deeper than you want me 2 go\",\"url\":null,\"description\":\"If you took my location the wrong way I've already proved my point... You shouldn't follow me.\\r\\nHoward University| My Life is Lavish| Galis.\",\"translator_type\":\"none\",\"protected\":false,\"verified\":false,\"followers_count\":308,\"friends_count\":264,\"listed_count\":0,\"favourites_count\":79,\"statuses_count\":26594,\"created_at\":\"Sat Jul 17 16:21:02 +0000 2010\",\"utc_offset\":null,\"time_zone\":null,\"geo_enabled\":true,\"lang\":\"en\",\"contributors_enabled\":false,\"is_translator\":false,\"profile_background_color\":\"1A1B1F\",\"profile_background_image_url\":\"http:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_image_url_https\":\"https:\\/\\/abs.twimg.com\\/images\\/themes\\/theme1\\/bg.png\",\"profile_background_tile\":true,\"profile_link_color\":\"2FC2EF\",\"profile_sidebar_border_color\":\"181A1E\",\"profile_sidebar_fill_color\":\"252429\",\"profile_text_color\":\"666666\",\"profile_use_background_image\":true,\"profile_image_url\":\"http:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"profile_image_url_https\":\"https:\\/\\/pbs.twimg.com\\/profile_images\\/2903646442\\/c8927d19acec1733732868ca59e12eb4_normal.jpeg\",\"default_profile\":false,\"default_profile_image\":false,\"following\":null,\"follow_request_sent\":null,\"notifications\":null},\"geo\":null,\"coordinates\":null,\"place\":null,\"contributors\":null,\"is_quote_status\":false,\"quote_count\":0,\"reply_count\":0,\"retweet_count\":0,\"favorite_count\":0,\"entities\":{\"hashtags\":[],\"urls\":[],\"user_mentions\":[{\"screen_name\":\"candidbeautyy\",\"name\":\"\\u270c\",\"id\":3346410125,\"id_str\":\"3346410125\",\"indices\":[27,41]},{\"screen_name\":\"__NYStateOfMind\",\"name\":\"Paulie Gambino\",\"id\":50446721,\"id_str\":\"50446721\",\"indices\":[91,107]}],\"symbols\":[]},\"favorited\":false,\"retweeted\":false,\"filter_level\":\"low\",\"lang\":\"en\",\"matching_rules\":[{\"tag\":null}]}],\"next\":\"eyJhdXRoZW50aWNpdHkiOiJkY2Q3MjAyNWFhMzI4NGY2MjE4OWUwZjNmNWRiYWE2ZDFkYzJmMjIwZmJhNjQxYzhkOWFlODUxOWY1MGExODA3IiwiZnJvbURhdGUiOiIyMDEwMDEwMTAwMDAiLCJ0b0RhdGUiOiIyMDExMDczMTAwMDAiLCJuZXh0IjoiMjAxMTA3MzEwMDAwMDAtOTczMzUzMzkwMDUzODI2NTYtMCJ9\",\"requestParameters\":{\"maxResults\":10,\"fromDate\":\"201001010000\",\"toDate\":\"201107310000\"}}";
	private static final ObjectMapper mapper = new Jackson2ObjectMapperBuilder().createXmlMapper(false).build();
	
	private final long FROM_DATE =201001010000L;
	private final long TO_DATE=201101010000L;
	
	
	@InjectMocks
	private TwitterPremiumSearchService SUT;
	@Mock
	private OAuth2RestTemplate oAuth2RestTemplate;
	
	@Test
	public void testSinglePageRestCall() {
		ResponseEntity<TwitterTweetsSearchAPIResponse> mockedSinglePageResponse = createResponseEntity(singlePageResponse);
		Mockito.when(oAuth2RestTemplate.exchange(any(String.class),any(HttpMethod.class),any(HttpEntity.class),Mockito.eq(TwitterTweetsSearchAPIResponse.class))).thenReturn(mockedSinglePageResponse);
		RequestParameters parameters = new RequestParameters();
		parameters.setFromDate(FROM_DATE);
		parameters.setToDate(TO_DATE);
		TwitterTweetsSearchAPIRequest reqParams = new TwitterTweetsSearchAPIRequest("@blessed2breathe", null, parameters );
		SUT.getTweets(reqParams);
		verify(oAuth2RestTemplate).exchange(any(String.class),any(HttpMethod.class),any(HttpEntity.class),Mockito.eq(TwitterTweetsSearchAPIResponse.class));
	}
	
	@Test
	public void testMultiPageRestCall() {
		ResponseEntity<TwitterTweetsSearchAPIResponse> mockedSinglePageResponse = createResponseEntity(singlePageResponse);
		ResponseEntity<TwitterTweetsSearchAPIResponse> mockedMultiPageResponse = createResponseEntity(multiPageResponse);
		when(oAuth2RestTemplate.exchange(any(String.class),any(HttpMethod.class),any(HttpEntity.class),Mockito.eq(TwitterTweetsSearchAPIResponse.class))).thenAnswer(new Answer<ResponseEntity<TwitterTweetsSearchAPIResponse>>() {
			private int count = 0;
			@Override
			public ResponseEntity<TwitterTweetsSearchAPIResponse> answer(InvocationOnMock invocation) throws Throwable {
				if (0 == count) {
					count++; 
					return mockedMultiPageResponse;
				}else {
					return mockedSinglePageResponse;
				}
			}
		});
		RequestParameters parameters = new RequestParameters();
		parameters.setFromDate(FROM_DATE);
		parameters.setToDate(TO_DATE);
		TwitterTweetsSearchAPIRequest reqParams = new TwitterTweetsSearchAPIRequest("@blessed2breathe", null, parameters );
		SUT.getTweets(reqParams);
		verify(oAuth2RestTemplate, Mockito.times(2)).exchange(any(String.class),any(HttpMethod.class),any(HttpEntity.class),Mockito.eq(TwitterTweetsSearchAPIResponse.class));
	}
	private ResponseEntity<TwitterTweetsSearchAPIResponse>createResponseEntity(String data){
		ResponseEntity<TwitterTweetsSearchAPIResponse> response = null;
		try {
			TwitterTweetsSearchAPIResponse body = mapper.readValue(data, TwitterTweetsSearchAPIResponse.class);
			response = ResponseEntity.ok(body);
		} catch (IOException e) {
			e.printStackTrace();
		}
		return response;
	}
	
}
